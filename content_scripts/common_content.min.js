"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function timeStampString(e){var t=new Date;return t.setTime(e),t.toLocaleString()}function getDocumentOrigin(){var e=window.location.origin?window.location.origin:"*";return"file://"!==e&&"null"!==e||(e="*"),e}function generateQuickGuid(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)}function listElements(e,t,n){for(var o=[],r=void 0,i=document.createNodeIterator(e,t,null);r=i.nextNode();)n(r)&&o.push(r),r.shadowRoot&&o.push.apply(o,_toConsumableArray(listElements(r.shadowRoot,t,n)));return o}function isElementVisible(e){return e.offsetHeight>0&&e.offsetWidth>0}function isElementClickable(e){var t="a, button, select, input, textarea, summary, *[onclick], *[contenteditable=true], *.jfk-button, *.goog-flat-menu-button, *[role=button], *[role=link], *[role=menuitem], *[role=option], *[role=switch], *[role=tab], *[role=checkbox], *[role=combobox], *[role=menuitemcheckbox], *[role=menuitemradio]";return runtime.conf.clickableSelector.length&&(t+=", "+runtime.conf.clickableSelector),e.matches(t)||"pointer"===getComputedStyle(e).cursor||"url("===getComputedStyle(e).cursor.substr(0,4)||null!==e.closest("a, *[onclick], *[contenteditable=true], *.jfk-button, *.goog-flat-menu-button")}function dispatchMouseEvent(e,t,n){t.forEach(function(t){var o=n?1:0,r=new MouseEvent(t,{bubbles:!0,cancelable:!0,view:window,button:o});e.dispatchEvent(r)})}function getRealEdit(e){for(var t=e?e.target:document.activeElement;t&&t.shadowRoot;){if(!t.shadowRoot.activeElement){if(t.shadowRoot.querySelector("input, textarea, select")){t=t.shadowRoot.querySelector("input, textarea, select");break}break}t=t.shadowRoot.activeElement}return t===window&&(t=document.body),t}function toggleQuote(){var e=getRealEdit(),t=e.value;'"'===t[0]?e.value=t.substr(1,t.length-2):e.value='"'+t+'"'}function isEditable(e){return e&&!e.disabled&&("textarea"===e.localName||"select"===e.localName||e.isContentEditable||"input"===e.localName&&/^(?!button|checkbox|file|hidden|image|radio|reset|submit)/i.test(e.type))}function parseQueryString(e){var t={};if(e.length)for(var n=e.split("&"),o=0,r=n.length;o<r;++o){var i=n[o].split("="),a=i[0].toLowerCase(),s=i.length>1?i[1]:null;t[decodeURIComponent(a)]=decodeURIComponent(s)}return t}function reportIssue(e,t){e=encodeURIComponent(e),t="%23%23+Error+details%0A%0A{0}%0A%0ASurfingKeys%3A+{1}%0A%0AChrome%3A+{2}%0A%0AURL%3A+{3}%0A%0A%23%23+Context%0A%0A%2A%2APlease+replace+this+with+a+description+of+how+you+were+using+SurfingKeys.%2A%2A".format(encodeURIComponent(t),chrome.runtime.getManifest().version,encodeURIComponent(navigator.userAgent),encodeURIComponent(window.location.href));var n='<h2>Uh-oh! The SurfingKeys extension encountered a bug.</h2> <p>Please click <a href="https://github.com/brookhong/Surfingkeys/issues/new?title={0}&body={1}" target=_blank>here</a> to start filing a new issue, append a description of how you were using SurfingKeys before this message appeared, then submit it.  Thanks for your help!</p>'.format(e,t);Front.showPopup(n)}function scrollIntoViewIfNeeded(e,t){e.scrollIntoViewIfNeeded?e.scrollIntoViewIfNeeded():isElementPartiallyInViewport(e,t)||e.scrollIntoView()}function isElementDrawn(e,t){var n=isEditable(e)?1:4;return t=t||e.getBoundingClientRect(),t.width>n&&t.height>n}function isElementPartiallyInViewport(e,t){var n=e.getBoundingClientRect(),o=window.innerHeight||document.documentElement.clientHeight,r=window.innerWidth||document.documentElement.clientWidth;return(t||isElementDrawn(e,n))&&n.top<o&&n.bottom>0&&n.left<r&&n.right>0}function getVisibleElements(e){for(var t=Array.from(document.documentElement.getElementsByTagName("*")),n=[],o=0;o<t.length;o++){var r=t[o];if(r.shadowRoot)for(var i=r.shadowRoot.querySelectorAll("*"),a=0;a<i.length;a++)t.push(i[a]);var s=r.getBoundingClientRect();s.top<=window.innerHeight&&s.bottom>=0&&s.left<=window.innerWidth&&s.right>=0&&s.height>0&&e(r,n)}return n}function actionWithSelectionPreserved(e){var t=document.getSelection(),n=[t.type,t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset],o=document.scrollingElement.scrollTop;e(t),document.scrollingElement.scrollTop=o,"None"===n[0]?t.empty():"Caret"===n[0]?t.setPosition(n[3],n[4]):"Range"===n[0]&&(t.setPosition(n[1],n[2]),t.extend(n[3],n[4]))}function filterAncestors(e){var t=[];if(e.length>0){t=[e[e.length-1]];for(var n=e.length-2;n>=0;n--)e[n].contains(t[0])||t.unshift(e[n])}return t}function filterOverlapElements(e){e=e.filter(function(e){var t=e.getClientRects()[0];if(e.disabled||e.readOnly||!isElementDrawn(e,t))return!1;if(e.matches("input, textarea, select, form")||"true"===e.contentEditable)return!0;var n=document.elementFromPoint(t.left+t.width/2,t.top+3);return!n||n.shadowRoot&&0===n.childElementCount||n.contains(e)||e.contains(n)});var t=null;return e=e.filter(function(e){var n=!0;return e.href&&(t=e),t&&t!==e&&t.contains(e)&&(n=!1),n}),filterAncestors(e)}function getTextNodes(e,t,n){var o=["script","style","noscript","surfingkeys_mark"],r=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,{acceptNode:function(e){if(!e.data.trim()||!e.parentNode.offsetParent||o.indexOf(e.parentNode.localName.toLowerCase())!==-1||!t.test(e.data))return t.lastIndex=0,NodeFilter.FILTER_REJECT;var n=e.parentNode.getBoundingClientRect();return n.width<4||n.height<4?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}},!1),i=[];if(1===n)i.push(r.firstChild());else if(n===-1)i.push(r.lastChild());else{if(0===n)return r;if(2===n)for(;r.nextNode();)i.push(r.currentNode.parentNode);else for(;r.nextNode();)i.push(r.currentNode)}return i}function getTextNodePos(e,t,n){var o=document.getSelection();o.setBaseAndExtent(e,t,e,n?t+n:e.data.length);var r=o.getRangeAt(0).getClientRects()[0],i={left:-1,top:-1};return r&&r.height>0&&r.width>0&&(i.left=r.left,i.top=r.top,i.width=r.width,i.height=r.height),i}function initL10n(e){var t=runtime.conf.language||window.navigator.language;"en-US"===t?e(function(e){return e}):fetch(chrome.extension.getURL("pages/l10n.json")).then(function(e){return e.json()}).then(function(n){"object"===_typeof(n[t])?(n=n[t],e(function(e){return n[e]?n[e]:e})):e(function(e){return e})})}function _parseAnnotation(e){var t=e.annotation.match(/#(\d+)(.*)/);return null!==t&&(e.feature_group=parseInt(t[1]),e.annotation=t[2]),e}function _map(e,t,n){n=KeyboardUtils.encodeKeystroke(n);var o=e.mappings.find(n);if(o){t=KeyboardUtils.encodeKeystroke(t),e.mappings.remove(t);var r=Object.assign({},o.meta);e.mappings.add(t,r),Front.isProvider()||Front.addMapkey(e.name,t,n)}return o}function RUNTIME(e,t){var n=["closeTab","nextTab","previousTab","moveTab","reloadTab","setZoom","closeTabLeft","closeTabRight","focusTabByIndex"];(t=t||{}).action=e,n.indexOf(e)!==-1&&(t.repeats=RUNTIME.repeats,RUNTIME.repeats=1);try{chrome.runtime.sendMessage(t)}catch(o){Front.showPopup("[runtime exception] "+o)}}function getAnnotations(e){return e.getWords().map(function(t){var n=e.find(t).meta;return{word:t,feature_group:n.feature_group,annotation:n.annotation}}).filter(function(e){return e.annotation&&e.annotation.length>0})}function constructSearchURL(e,t){return e.indexOf("{0}")>0?e.format(t):e+t}function tabOpenLink(e,t){t=t||5;var n;n="Array"===e.constructor.name?e:e instanceof NodeList?Array.from(e).map(function(e){return e.href}):e.trim().split("\n"),n=n.map(function(e){return e.trim()}).filter(function(e){return e.length>0}),n.slice(0,t).forEach(function(e){RUNTIME("openLink",{tab:{tabbed:!0},url:e})}),n.length>t&&RUNTIME("queueURLs",{urls:n.slice(t)})}function getElements(e){return listElements(document.body,NodeFilter.SHOW_ELEMENT,function(t){return t.offsetHeight&&t.offsetWidth&&t.matches(e)})}function getClickableElements(e,t){var n=listElements(document.body,NodeFilter.SHOW_ELEMENT,function(n){return n.offsetHeight&&n.offsetWidth&&"pointer"===getComputedStyle(n).cursor&&(n.matches(e)||t.test(n.textContent))});return filterOverlapElements(n)}function filterInvisibleElements(e){return e.filter(function(e){return e.offsetHeight&&e.offsetWidth&&!e.getAttribute("disabled")&&isElementPartiallyInViewport(e)})}function setInnerHTML(e,t){e.innerHTML=t}function createElement(e){var t=document.createElement("div");return setInnerHTML(t,e),t.firstChild}function hasScroll(e,t,n){var o="y"===t?["scrollTop","height"]:["scrollLeft","width"],r=e[o[0]];if(r<n){var i=e[o[0]];e[o[0]]=e.getBoundingClientRect()[o[1]],r=e[o[0]],e[o[0]]=i}return r>=n}function isEmptyObject(e){for(var t in e)return!1;return!0}function htmlEncode(e){return _divForHtmlEncoder.innerText=e,_divForHtmlEncoder.innerHTML}function usePdfViewer(){function e(){var e=document.body.querySelectorAll("*");1===e.length&&"EMBED"===e[0].tagName&&"application/pdf"===e[0].type&&chrome.storage.local.get("noPdfViewer",function(t){t.noPdfViewer||window.location.replace(chrome.extension.getURL("/pages/pdf_viewer.html")+"?r="+e[0].src)})}document.body?e():document.addEventListener("DOMContentLoaded",function(t){e()})}function readText(e,t){t=t||{enqueue:!0,voiceName:runtime.conf.defaultVoice};var n=t.verbose,o=/[\s\u00a0]/g,n=t.verbose,r=t.onEnd;delete t.verbose,delete t.onEnd,runtime.command({action:"read",content:e,options:t},function(t){if(n)if("start"===t.ttsEvent.type)Front.showPopup(e);else if("word"===t.ttsEvent.type){o.lastIndex=t.ttsEvent.charIndex;var i,a=o.exec(e);i=a?e.substr(0,t.ttsEvent.charIndex)+"<font style='font-weight: bold; text-decoration: underline'>"+e.substr(t.ttsEvent.charIndex,a.index-t.ttsEvent.charIndex+1)+"</font>"+e.substr(a.index):e.substr(0,t.ttsEvent.charIndex)+"<font style='font-weight: bold; text-decoration: underline'>"+e.substr(t.ttsEvent.charIndex)+"</font>",Front.showPopup(i)}else"end"===t.ttsEvent.type&&Front.hidePopup();return r&&"end"===t.ttsEvent.type&&r(),"end"!==t.ttsEvent.type})}var _slicedToArray=function(){function e(e,t){var n=[],o=!0,r=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(o=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);o=!0);}catch(l){r=!0,i=l}finally{try{!o&&s["return"]&&s["return"]()}finally{if(r)throw i}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Trie=function(){function e(){arguments.length>0&&(this.stem=arguments[0]),arguments.length>1&&(this.meta=arguments[1])}return e.prototype={find:function(e){for(var t=this,n=e.length,o=0;o<n&&t;o++)t=t[e[o]];return t},add:function(t,n){for(var o=this,r=t.length,i=0;i<r;i++){var a=t[i];if(o.hasOwnProperty(a))o=o[a];else{var s=new e(a);o[a]=s,o=s}}n.word=t,o.meta=n},remove:function(e){for(var t=this,n=e.length,o=[],r=0;r<n&&t;r++)o.push(t),t=t[e[r]];if(t){var r=o.length-1,i=o[r];for(delete i[t.stem],t=i;t!==this&&1===Object.keys(t).length;)i=o[--r],delete i[t.stem],t=i}return t},getWords:function(e,t){var n=[],e=(e||"")+(t?"":this.stem||"");this.hasOwnProperty("meta")&&n.push(e);for(var o in this)1===o.length&&(n=n.concat(this[o].getWords(e)));return n},getMetas:function(e){var t=[];this.hasOwnProperty("meta")&&e(this.meta)&&t.push(this.meta);for(var n in this)1===n.length&&(t=t.concat(this[n].getMetas(e)));return t},getPrefixWord:function(){if(0===Object.keys(this).length)return"";for(var e="",t=this.stem,n=this;""===e;)for(var o=Object.keys(n),r=0;r<o.length;r++){if("meta"===o[r]){e=n.meta.word;break}if("stem"!==o[r]){t+=o[r],n=n[o[r]];break}}return e.substr(0,e.length-t.length+1)}},e}(),KeyboardUtils=function(){function e(e,n){var o=0;e.indexOf("Ctrl-")!==-1&&(o|=1),e.indexOf("Alt-")!==-1&&(o|=2),e.indexOf("Meta-")!==-1&&(o|=4),e.indexOf("Shift-")!==-1&&(o|=8);var r;return r=n.length>1?256+t.specialKeys.indexOf(n):n.charCodeAt(0),r=8192+(r<<4)+o,String.fromCharCode(r)}var t={keyCodesMac:{Minus:["-","_"],Equal:["=","+"],BracketLeft:["[","{"],BracketRight:["]","}"],Backslash:["\\","|"],Semicolon:[";",":"],Quote:["'",'"'],Comma:[",","<"],Period:[".",">"],Slash:["/","?"]},keyCodes:{ESC:27,backspace:8,deleteKey:46,enter:13,ctrlEnter:10,space:32,shiftKey:16,ctrlKey:17,f1:112,f12:123,comma:188,tab:9,downArrow:40,upArrow:38},modifierKeys:{16:"Shift",17:"Ctrl",18:"Alt",91:"Meta",92:"Meta",93:"ContextMenu",229:"Process"},keyNames:{8:"Backspace",9:"Tab",12:"NumLock",27:"Esc",32:"Space",46:"Delete"},keyIdentifierCorrectionMap:{"U+00C0":["U+0060","U+007E"],"U+0030":["U+0030","U+0029"],"U+0031":["U+0031","U+0021"],"U+0032":["U+0032","U+0040"],"U+0033":["U+0033","U+0023"],"U+0034":["U+0034","U+0024"],"U+0035":["U+0035","U+0025"],"U+0036":["U+0036","U+005E"],"U+0037":["U+0037","U+0026"],"U+0038":["U+0038","U+002A"],"U+0039":["U+0039","U+0028"],"U+00BD":["U+002D","U+005F"],"U+00BB":["U+003D","U+002B"],"U+00DB":["U+005B","U+007B"],"U+00DD":["U+005D","U+007D"],"U+00DC":["U+005C","U+007C"],"U+00BA":["U+003B","U+003A"],"U+00DE":["U+0027","U+0022"],"U+00BC":["U+002C","U+003C"],"U+00BE":["U+002E","U+003E"],"U+00BF":["U+002F","U+003F"]}},n="Windows";return"undefined"!=typeof navigator&&(navigator.platform.indexOf("Mac")!==-1?n="Mac":navigator.userAgent.indexOf("Linux")!==-1&&(n="Linux")),t.getKeyChar=function(e){var o;if(e.keyCode in this.modifierKeys)o="";else{if(this.keyNames.hasOwnProperty(e.keyCode))o="{0}".format(this.keyNames[e.keyCode]);else if(o=e.key||"",["Shift","Meta","Alt","Ctrl"].indexOf(o)!==-1&&(o=""),o)o.charCodeAt(0)>127||"Dead"===o?e.keyCode<127?(o=String.fromCharCode(e.keyCode),o=e.shiftKey?o:o.toLowerCase()):this.keyCodesMac.hasOwnProperty(e.code)&&(o=this.keyCodesMac[e.code][e.shiftKey?1:0]):"Unidentified"===o&&(o="");else if(e.keyIdentifier)if("U+"!==e.keyIdentifier.slice(0,2))o="{0}".format(e.keyIdentifier);else{var r=e.keyIdentifier;if(("Windows"===n||"Linux"===n)&&this.keyIdentifierCorrectionMap[r]){var i=this.keyIdentifierCorrectionMap[r];r=e.shiftKey?i[1]:i[0]}var a="0x"+r.substring(2);o=String.fromCharCode(parseInt(a)),o=e.shiftKey?o:o.toLowerCase()}e.shiftKey&&o.length>1&&(o="Shift-"+o),o.length>0&&(e.metaKey&&(o="Meta-"+o),e.altKey&&(o="Alt-"+o),e.ctrlKey&&(o="Ctrl-"+o)),o.length>1&&(o="<{0}>".format(o))}return t.decodeKeystroke(t.encodeKeystroke(o))===o&&(o=t.encodeKeystroke(o)),o},t.isWordChar=function(e){return e.keyCode<123&&e.keyCode>=97||e.keyCode<91&&e.keyCode>=65||e.keyCode<58&&e.keyCode>=48},t.encodeKeystroke=function(t){for(var n,o=/<(?:Ctrl-)?(?:Alt-)?(?:Meta-)?(?:Shift-)?([^>]+|.)>/g,r="",i=0;null!==(n=o.exec(t));)r+=t.substr(i,n.index-i),r+=e(n[0],n[1]),i=o.lastIndex;return r+=t.substr(i)},t.specialKeys=["Esc","Space","F1","F2","F3","F4","F5","F6","F7","F8","F9","F10","F11","F12","ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Backspace","Enter","Tab","Delete","End","Home","Insert","NumLock","PageDown","PageUp","Pause","ScrollLock","CapsLock","PrintScreen","Escape","Hyper"],t.decodeKeystroke=function(e){for(var n="",o=0;o<e.length;o++){var r=e[o].charCodeAt(0);if(r>8192){r-=8192;var i=r>>12,a=r%4096>>4,s=15&r;r=i?t.specialKeys[a%256]:String.fromCharCode(a),8&s&&(r="Shift-"+r),4&s&&(r="Meta-"+r),2&s&&(r="Alt-"+r),1&s&&(r="Ctrl-"+r),n+="<"+r+">"}else n+=e[o]}return n},t}();String.prototype.format=function(){for(var e=this,t=0;t<arguments.length;t++){var n=new RegExp("\\{"+t+"\\}","gi");e=e.replace(n,arguments[t])}return e},RegExp.prototype.toJSON=function(){return{source:this.source,flags:this.flags}},Array.prototype.flatMap||(Array.prototype.flatMap=function(e){return Array.prototype.concat.apply([],this.map(e))});var _divForHtmlEncoder=createElement("<div />");HTMLElement.prototype.one=function(e,t){function n(){t.call(this),this.removeEventListener(e,n)}this.addEventListener(e,n)},HTMLElement.prototype.show=function(){this.style.display=""},HTMLElement.prototype.hide=function(){this.style.display="none"},HTMLElement.prototype.removeAttributes=function(){for(;this.attributes.length>0;)this.removeAttribute(this.attributes[0].name)},NodeList.prototype.remove=function(){this.forEach(function(e){e.remove()})},NodeList.prototype.show=function(){this.forEach(function(e){e.show()})},NodeList.prototype.hide=function(){this.forEach(function(e){e.hide()})};var runtime=window.runtime||function(){var e={conf:{lastKeys:"",blacklistPattern:void 0,smartCase:!0,caseSensitive:!1,clickablePat:/(https?:\/\/|thunder:\/\/|magnet:)\S+/gi,clickableSelector:"",cursorAtEndOfInput:!0,defaultSearchEngine:"g",defaultVoice:"Daniel",editableBodyCare:!0,enableAutoFocus:!0,experiment:!1,focusFirstCandidate:!1,focusOnSaved:!0,hintAlign:"center",historyMUOrder:!0,language:void 0,lastQuery:"",modeAfterYank:"",nextLinkRegex:/(\b(next)\b)|下页|下一页|后页|>>|»/i,digitForRepeat:!0,omnibarMaxResults:10,omnibarPosition:"middle",omnibarSuggestion:!0,omnibarSuggestionTimeout:200,omnibarTabsQuery:{},pageUrlRegex:[],prevLinkRegex:/(\b(prev|previous)\b)|上页|上一页|前页|<<|«/i,richHintsForKeystroke:1e3,scrollStepSize:70,showModeStatus:!1,showProxyInStatusBar:!1,smartPageBoundary:!1,smoothScroll:!0,startToShowEmoji:2,stealFocusOnLoad:!0,tabsThreshold:9,textAnchorPat:/(^[\n\r\s]*\S{3,}|\b\S{4,})/g,ignoredFrameHosts:["https://tpc.googlesyndication.com"],scrollFriction:0,aceKeybindings:"vim",caretViewport:null,mouseSelectToQuery:[],useLocalMarkdownAPI:!0},runtime_handlers:{}},t={};if(!chrome.runtime.connect)return e;var n=chrome.runtime.connect({name:"main"});n.onDisconnect.addListener(function(e){window===top&&(console.log("reload triggered by runtime disconnection."),setTimeout(function(){window.location.reload()},1e3))});var o={};n.onMessage.addListener(function(e){if(o[e.id]){var r=o[e.id];r(e)||delete o[e.id]}else if(t[e.action]){var i={id:e.id,action:e.action};t[e.action].forEach(function(t){i.data=t.call(null,e),e.ack&&n.postMessage(i)})}else window===top&&console.log("[unexpected runtime message] "+JSON.stringify(e))}),e.on=function(e,n){e in t||(t[e]=[]),t[e].push(n)},e.command=function(e,t){e.id=generateQuickGuid(),t&&(o[e.id]=t,e.ack=!0),n.postMessage(e)},e.updateHistory=function(t,n){var o=t+"History";runtime.command({action:"getSettings",key:o},function(t){var r=t.settings[o]||[],i={};"Array"===n.constructor.name?(i[o]=n,e.command({action:"updateSettings",settings:i})):n.trim().length&&"."!==n&&(r=r.filter(function(e){return e.trim().length&&e!==n&&"."!==e}),r.unshift(n),r.length>50&&r.pop(),i[o]=r,e.command({action:"updateSettings",settings:i}))})},chrome.runtime.onMessage.addListener(function(t,n,o){"content_runtime"===t.target&&e.runtime_handlers[t.subject]&&e.runtime_handlers[t.subject](t,n,o)});var r=new Promise(function(t,n){window===top?t(window.location.href):e.command({action:"getTopURL"},function(e){t(e.url)})});return e.getTopURL=function(e){r.then(function(t){e(t)})},e.postTopMessage=function(e){r.then(function(t){window===top&&(t=window.location.origin),"null"!==t&&"file://"!==new URL(t).origin||(t="*"),top.postMessage(e,t)})},e.getCaseSensitive=function(t){return e.conf.caseSensitive||e.conf.smartCase&&/[A-Z]/.test(t)},e}(),Mode=function(){function e(e,t){t=CustomCommands.handleKeyPropagation(e,t),t.sk_stopPropagation&&(t.stopImmediatePropagation(),t.preventDefault(),e.stopKeyupPropagation="keydown"===t.type&&e.enableKeyupMerging?t.keyCode:0)}function t(t,n,r){for(var i=0;i<o.length&&!n.sk_stopPropagation;i++){var a=o[i];if(!n.sk_suppressed&&a.eventListeners.hasOwnProperty(t)){var s=a.eventListeners[t];s(n),e(a,n)}if("Disabled"===a.name)break;r&&r(a)}}var n=function i(e,n){this.name=e,this.statusLine=n,this.eventListeners={},this.addEventListener=function(e,n){return this.eventListeners[e]=n,r.indexOf(e)===-1&&(r.push(e),window.addEventListener(e,t.bind(t,e),!0)),this},this.enter=function(e,t){var n=o.indexOf(this);if(this.priority||(this.priority=e||o.length),n===-1)o.unshift(this);else if(n>0)if(t)o=o.slice(n);else{var r=o.map(function(e){return e.name}).join(",");reportIssue("Mode {0} pushed into mode stack again.".format(this.name),"Modes in stack: {0}".format(r))}return o.sort(function(e,t){return e.priority<t.priority?1:t.priority<e.priority?-1:0}),this.onEnter&&this.onEnter(),i.showStatus(),n},this.exit=function(e){var t=o.indexOf(this);if(t!==-1)if(this.priority=0,e)o.splice(t,1);else{t++;o.slice(0,t);o=o.slice(t)}i.showStatus(),this.onExit&&this.onExit(t)}},o=[];n.specialKeys={"<Alt-s>":["<Alt-s>"],"<Esc>":["<Esc>"]},n.isSpecialKeyOf=function(e,t){return-1!==n.specialKeys[e].indexOf(KeyboardUtils.decodeKeystroke(t))};var r=["keydown","keyup"];return n.init=function(){window.addEventListener("keydown",function(e){e.sk_keyName=KeyboardUtils.getKeyChar(e),t("keydown",e)},!0),window.addEventListener("keyup",function(e){t("keyup",e,function(t){t.stopKeyupPropagation===e.keyCode&&(e.stopImmediatePropagation(),t.stopKeyupPropagation=0)})},!0)},"about:blank"===window.location.href&&window.frameElement?window.frameElement.addEventListener("load",function(e){try{n.init(),r.forEach(function(e){["keydown","keyup"].indexOf(e)===-1&&window.addEventListener(e,t.bind(t,e),!0)})}catch(o){console.log("Error on blank iframe loaded: "+o)}}):n.init(),n.showStatus=function(){if(document.hasFocus()&&o.length){var e=o[0],t=e.statusLine;if(void 0===t&&(t=runtime.conf.showModeStatus?e.name:""),""!==t&&window!==top)if(0===chrome.extension.getURL("").indexOf(window.location.origin))e!==Find&&(t+="✩");else{var n=window.location.pathname.split("/");n.length&&(t+=" - frame: "+n[n.length-1])}Front.showStatus(0,t)}},n.stack=function(){return o},n.finish=function(e){var t=!1;return(e.map_node!==e.mappings||null!=e.pendingMap||e.repeats)&&(e.map_node=e.mappings,e.pendingMap=null,e.isTrustedEvent&&Front.hideKeystroke(),e.repeats&&(e.repeats=""),t=!0),t},n.handleMapKey=function(t,o){var r=this,i=t.sk_keyName;this.isTrustedEvent=t.isTrusted;var a=Mode.isSpecialKeyOf("<Esc>",i);if(a&&(i=KeyboardUtils.encodeKeystroke("<Esc>")),a&&n.finish(this))t.sk_stopPropagation=!0,t.sk_suppressed=!0;else if(this.pendingMap){this.setLastKeys&&this.setLastKeys(this.map_node.meta.word+i);var s=this.pendingMap.bind(this);t.sk_stopPropagation=!this.map_node.meta.stopPropagation||this.map_node.meta.stopPropagation(i),setTimeout(function(){s(i),n.finish(r),e(r,t)},0)}else if(void 0!==this.repeats&&this.map_node===this.mappings&&runtime.conf.digitForRepeat&&(i>="1"||""!==this.repeats&&i>="0")&&i<="9")this.repeats+=i,this.isTrustedEvent&&Front.showKeystroke(i,this),t.sk_stopPropagation=!0;else{var l=this.map_node;if(this.map_node=this.map_node.find(i),this.map_node)if(this.map_node.meta){var c=this.map_node.meta.code;c.length?(this.pendingMap=c,this.isTrustedEvent&&Front.showKeystroke(i,this),t.sk_stopPropagation=!0):(this.setLastKeys&&this.setLastKeys(this.map_node.meta.word),RUNTIME.repeats=parseInt(this.repeats)||1,t.sk_stopPropagation=!this.map_node.meta.stopPropagation||this.map_node.meta.stopPropagation(i),setTimeout(function(){for(;RUNTIME.repeats>0;)c(),RUNTIME.repeats--;n.finish(r),e(r,t)},0))}else this.isTrustedEvent&&Front.showKeystroke(i,this),t.sk_stopPropagation=!0;else o&&o(l),t.sk_suppressed=l!==this.mappings,n.finish(this)}},n}(),Disabled=function(){var e=new Mode("Disabled");return e.priority=99,e.addEventListener("keydown",function(t){t.sk_suppressed=!0,Mode.isSpecialKeyOf("<Alt-s>",t.sk_keyName)&&(Normal.toggleBlacklist(),e.exit(),t.sk_stopPropagation=!0)}),e}(),PassThrough=function(){var e=new Mode("PassThrough","pass through");return e.addEventListener("keydown",function(t){t.sk_suppressed=!0,Mode.isSpecialKeyOf("<Esc>",t.sk_keyName)&&(e.exit(),t.sk_stopPropagation=!0)}).addEventListener("mousedown",function(e){e.sk_suppressed=!0}),e}(),Normal=function(){function e(e){if(e.skScrollBy=function(t,n){if(RUNTIME.repeats>1&&(t=RUNTIME.repeats*t,n=RUNTIME.repeats*n,RUNTIME.repeats=0),runtime.conf.smoothScroll){var o=Math.max(100,20*Math.log(Math.abs(t||n)));e.smoothScrollBy(t,n,o)}else document.dispatchEvent(new CustomEvent("surfingkeys:scrollStarted")),e.scrollLeft=e.scrollLeft+t,e.scrollTop=e.scrollTop+n,document.dispatchEvent(new CustomEvent("surfingkeys:scrollDone"))},e===document.scrollingElement){var t=e.skScrollBy;e.skScrollBy=function(n,o){runtime.conf.smartPageBoundary&&(0===document.scrollingElement.scrollTop&&o<=0?previousPage()&&Front.showBanner("Top margin hit, jump to previous page"):document.scrollingElement.scrollHeight-document.scrollingElement.scrollTop<=window.innerHeight+1&&o>0&&nextPage()&&Front.showBanner("Bottom margin hit, jump to next page")),t.call(e,n,o)}}e.smoothScrollBy=function(t,n,o){if(!u){var r=function g(t){if(0===d)return d=t,document.dispatchEvent(new CustomEvent("surfingkeys:scrollStarted")),window.requestAnimationFrame(g);var n=e[s],o=(t-d)*l/c;return Math.abs(n+o-f)>=Math.abs(l)?(p=!0,u>runtime.conf.scrollFriction?(e[s]+=o,f=e[s]):u>0?u++:e[s]=f+l):e[s]+=o,d=t,u||e[s]!==n&&!p?window.requestAnimationFrame(g):(u=0,e.style.scrollBehavior="",document.dispatchEvent(new CustomEvent("surfingkeys:scrollDone")),void 0)},i=n?["scrollTop",n]:["scrollLeft",t],a=_slicedToArray(i,2),s=a[0],l=a[1],c=o,d=0,f=e[s],p=!1;return u=1,e.style.scrollBehavior="auto",window.requestAnimationFrame(r)}}}function t(){c&&0!==c.length||(document.documentElement.style.overflow="visible",document.body.style.overflow="visible",c=o(100,1.1),f=0)}function n(e){var t=e.currentTarget;if(t.contains(e.target)){var n=c.lastIndexOf(e.target);if(n===-1){for(var o=c.length-1;o>=0;o--)if(c[o].contains(e.target)){n=o;break}n===-1&&console.warn("cannot find scrollable",e.target)}f=n}}function o(){var e=listElements(document.body,NodeFilter.SHOW_ELEMENT,function(e){return hasScroll(e,"y",16)&&e.scrollHeight>200||hasScroll(e,"x",16)&&e.scrollWidth>200});return e.sort(function(e,t){return t.contains(e)?1:e.contains(t)?-1:t.scrollHeight*t.scrollWidth-e.scrollHeight*e.scrollWidth}),(document.scrollingElement.scrollHeight>window.innerHeight||document.scrollingElement.scrollWidth>window.innerWidth)&&e.unshift(document.scrollingElement),e.forEach(function(e){e.removeEventListener("mousedown",n),e.addEventListener("mousedown",n),e.dataset.hint_scrollable=!0}),e}function r(e){var t;t=document.scrollingElement===e?{top:0,left:0,width:window.innerWidth,height:window.innerHeight}:e.getBoundingClientRect(),Front.highlightElement({duration:200,rect:{top:t.top,left:t.left,width:t.width,height:t.height}})}function i(e){if(c=o(100,1.1),c.length>0){f=(f+1)%c.length;var t=c[f];scrollIntoViewIfNeeded(t),e||r(t)}}function a(){RUNTIME("localData",{data:{lastKeys:d}})}var s=new Mode("Normal");s.enableKeyupMerging=!0;var l=!1;s.passFocus=function(e){l=e},s.onEnter=function(){if(runtime.conf.stealFocusOnLoad&&!Front.isProvider()){var e=getRealEdit();e&&e.blur()}},s.addEventListener("keydown",function(e){var t=getRealEdit(e);isEditable(t)&&e.isTrusted?Mode.isSpecialKeyOf("<Esc>",e.sk_keyName)?(t.blur(),Insert.exit()):runtime.conf.editableBodyCare&&t===document.body&&"i"!==e.key?(s.statusLine="Press i to enter Insert mode",runtime.conf.showModeStatus=!0,e.sk_keyName.length&&Mode.handleMapKey.call(s,e)):(Normal.passFocus(!0),e.sk_stopPropagation=runtime.conf.editableBodyCare&&t===document.body&&"i"===e.key,e.sk_stopPropagation&&t.focus(),Insert.enter(t,!0)):Mode.isSpecialKeyOf("<Alt-s>",e.sk_keyName)?(s.toggleBlacklist(),Mode.finish(s),e.sk_stopPropagation=!0):e.sk_keyName.length&&Mode.handleMapKey.call(s,e)}),s.addEventListener("blur",function(e){u=0}),s.addEventListener("focus",function(e){if(Mode.showStatus(),runtime.conf.stealFocusOnLoad&&!Front.isProvider()){var t=getRealEdit(e);isEditable(t)&&(l||t.enableAutoFocus?runtime.conf.enableAutoFocus||(l=!1):(t.blur(),e.sk_stopPropagation=!0))}}),s.addEventListener("keyup",function(e){setTimeout(function(){u=0},0)}),s.addEventListener("mousedown",function(e){runtime.conf.enableAutoFocus?s.passFocus(!0):s.passFocus(e.isTrusted);var t=getRealEdit(e);isEditable(t)||t.matches("div.CodeMirror-scroll")?Insert.enter(t,!0):Insert.exit()}),s.toggleBlacklist=function(){0!==document.location.href.indexOf(chrome.extension.getURL(""))?runtime.command({action:"toggleBlacklist",blacklistPattern:runtime.conf.blacklistPattern?runtime.conf.blacklistPattern.toJSON():""},function(e){e.disabled?e.blacklist.hasOwnProperty(".*")?Front.showBanner("Surfingkeys is globally disabled, please enable it globally from popup menu.",3e3):Front.showBanner("Surfingkeys turned OFF for "+e.url,3e3):Front.showBanner("Surfingkeys turned ON for "+e.url,3e3)}):Front.showBanner("You could not toggle Surfingkeys on its own pages.",3e3)},s.passThrough=function(){PassThrough.enter()},s.mappings=new Trie,s.map_node=s.mappings,s.repeats="";var c,d,u=0,f=0;return s.scroll=function(n){t();var o=document.scrollingElement;c.length>0&&(o=c[f]),o.skScrollBy||e(o);var r=o===document.scrollingElement?[window.innerWidth,window.innerHeight]:[o.offsetWidth,o.offsetHeight];switch(n){case"down":o.skScrollBy(0,runtime.conf.scrollStepSize);break;case"up":o.skScrollBy(0,-runtime.conf.scrollStepSize);break;case"pageDown":o.skScrollBy(0,Math.round(r[1]/2));break;case"fullPageDown":o.skScrollBy(0,r[1]);break;case"pageUp":o.skScrollBy(0,-Math.round(r[1]/2));break;case"fullPageUp":o.skScrollBy(0,-r[1]);break;case"top":o.skScrollBy(0,-o.scrollTop);break;case"bottom":o.skScrollBy(o.scrollLeft,o.scrollHeight-o.scrollTop);break;case"left":o.skScrollBy(-Math.round(runtime.conf.scrollStepSize/2),0);break;case"right":o.skScrollBy(Math.round(runtime.conf.scrollStepSize/2),0);break;case"leftmost":o.skScrollBy(-o.scrollLeft-10,0);break;case"rightmost":o.skScrollBy(o.scrollWidth-o.scrollLeft-r[0]+20,0);break;case"byRatio":var i=parseInt(RUNTIME.repeats*o.scrollHeight/100)-r[1]/2-o.scrollTop;RUNTIME.repeats=0,o.skScrollBy(0,i)}},s.refreshScrollableElements=function(){return c=null,t(),c},s.getScrollableElements=function(){return t(),c},s.rotateFrame=function(){RUNTIME("nextFrame")},s.feedkeys=function(e){setTimeout(function(){for(var t=new Event("keydown"),n=0;n<e.length;n++)t.sk_keyName=e[n],Mode.handleMapKey.call(s,t)},1)},s.setLastKeys=function(e){this.map_node.meta.repeatIgnore||(d=[e],a())},s.appendKeysForRepeat=function(e,t){d&&d.length>0&&(d.push("{0}\t{1}".format(e,t)),a())},s.repeatLast=function(){d=runtime.conf.lastKeys,s.feedkeys(d[0]);for(var e=d.slice(1),t=0;t<e.length;t++){var n=e[t].split("\t");if("Hints"===n[0]){var o=function(){var e=n[1];return function(){Hints.feedkeys(e)}};setTimeout(o(),120+100*t)}}},s.addVIMark=function(e,t){t=t||window.location.href;var n={};n[e]={url:t,scrollLeft:document.scrollingElement.scrollLeft,scrollTop:document.scrollingElement.scrollTop},RUNTIME("addVIMark",{mark:n}),Front.showBanner("Mark '{0}' added for: {1}.".format(e,t))},s.jumpVIMark=function(e){runtime.command({action:"jumpVIMark",mark:e},function(e){})},s.insertJS=function(e,t){var n=document.createElement("script");n.type="text/javascript","function"==typeof e?(setInnerHTML(n,"("+e.toString()+")(window);"),setTimeout(function(){n.remove()},1)):(n.src=e,n.onload=function(){t(),n.remove()}),document.lastElementChild.appendChild(n)},s.moveTab=function(e){RUNTIME("moveTab",{position:e})},s.captureElement=function(e){runtime.command({action:"getCaptureSize"},function(t){var n=t.width/window.innerWidth;e.scrollTop=0,e.scrollLeft=0;var o=-1,r=-1,i=e.style.overflowY;e.style.overflowY="hidden";var a=e.style.overflowX;e.style.overflowX="hidden";var s=e.style.borderStyle;e.style.borderStyle="none",Front.toggleStatus(!1);var l,c,d,u,f,p,g=0,h=0,m=e.scrollHeight,y=e.scrollWidth;if(e===document.scrollingElement)f=window.innerWidth,p=window.innerHeight,l=0,c=0;else{var v=e.getBoundingClientRect(),w=[Math.max(v.left,0),Math.max(v.top,0),Math.min(v.right,window.innerWidth),Math.min(v.bottom,window.innerHeight)];f=w[2]-w[0],p=w[3]-w[1],l=w[0]*n,c=w[1]*n}d=f*n,u=p*n;var b=document.createElement("canvas");b.width=y*n,b.height=m*n;var k=b.getContext("2d"),v=e.getBoundingClientRect(),E=document.createElement("img");E.onload=function(){k.drawImage(E,l,c,d,u,g,h,d,u),
o===e.scrollTop?r===e.scrollLeft?(Front.toggleStatus(!0),Front.showPopup("<img src='{0}' />".format(b.toDataURL("image/png"))),e.style.overflowY=i,e.style.overflowX=a,e.style.borderStyle=s):(o=-1,e.scrollTop=0,h=0,r=e.scrollLeft,e.scrollLeft+2*f<y?(e.scrollLeft+=f,g+=f*n):(e.scrollLeft+=y%f,g=e.scrollLeft*n),setTimeout(function(){runtime.command({action:"captureVisibleTab"},function(e){E.src=e.dataUrl})},100)):(o=e.scrollTop,e.scrollTop+2*p<m?(e.scrollTop+=p,h+=p*n):(e.scrollTop+=m%p,h=e.scrollTop*n),setTimeout(function(){runtime.command({action:"captureVisibleTab"},function(e){E.src=e.dataUrl})},100))},setTimeout(function(){runtime.command({action:"captureVisibleTab"},function(e){E.src=e.dataUrl})},500)})},s.mappings.add("yG",{annotation:"Capture current full page",feature_group:7,code:function(){s.captureElement(document.scrollingElement)}}),s.mappings.add("yS",{annotation:"Capture scrolling element",feature_group:7,code:function(){var e=document.scrollingElement;t(),c.length>0&&(e=c[f]),s.captureElement(e)}}),s.mappings.add("cS",{annotation:"Reset scroll target",feature_group:2,code:function(){if(c=null,t(),c.length>0){var e=c[f];r(e)}}}),s.mappings.add("e",{annotation:"Scroll a page up",feature_group:2,repeatIgnore:!0,code:s.scroll.bind(s,"pageUp")}),s.mappings.add("d",{annotation:"Scroll a page down",feature_group:2,repeatIgnore:!0,code:s.scroll.bind(s,"pageDown")}),s.mappings.add("gg",{annotation:"Scroll to the top of the page",feature_group:2,repeatIgnore:!0,code:s.scroll.bind(s,"top")}),s.mappings.add("G",{annotation:"Scroll to the bottom of the page",feature_group:2,repeatIgnore:!0,code:s.scroll.bind(s,"bottom")}),s.mappings.add("j",{annotation:"Scroll down",feature_group:2,repeatIgnore:!0,code:s.scroll.bind(s,"down")}),s.mappings.add("k",{annotation:"Scroll up",feature_group:2,repeatIgnore:!0,code:s.scroll.bind(s,"up")}),s.mappings.add("h",{annotation:"Scroll left",feature_group:2,repeatIgnore:!0,code:s.scroll.bind(s,"left")}),s.mappings.add("l",{annotation:"Scroll right",feature_group:2,repeatIgnore:!0,code:s.scroll.bind(s,"right")}),s.mappings.add("0",{annotation:"Scroll all the way to the left",feature_group:2,repeatIgnore:!0,code:s.scroll.bind(s,"leftmost")}),s.mappings.add("$",{annotation:"Scroll all the way to the right",feature_group:2,repeatIgnore:!0,code:s.scroll.bind(s,"rightmost")}),s.mappings.add("%",{annotation:"Scroll to percentage of current page",feature_group:2,repeatIgnore:!0,code:s.scroll.bind(s,"byRatio")}),s.mappings.add("cs",{annotation:"Change scroll target",feature_group:2,repeatIgnore:!0,code:function(){i()}}),s.mappings.add("f",{annotation:"Open a link, press SHIFT to flip overlapped hints, hold SPACE to hide hints",feature_group:1,repeatIgnore:!0,code:function(){Hints.create("",Hints.dispatchMouseClick)}}),s.mappings.add(";fs",{annotation:"Display hints to focus scrollable elements",feature_group:1,repeatIgnore:!0,code:function(){Hints.create(Normal.refreshScrollableElements(),Hints.dispatchMouseClick)}}),s.mappings.add("v",{annotation:"Toggle visual mode",feature_group:9,repeatIgnore:!0,code:function(){Visual.toggle()}}),s.mappings.add("cq",{annotation:"Query word with Hints",feature_group:7,repeatIgnore:!0,code:function(){Visual.toggle("q")}}),s.mappings.add("/",{annotation:"Find in current page",feature_group:9,repeatIgnore:!0,code:function(){Front.openFinder()}}),s.mappings.add("n",{annotation:"Next found text",feature_group:9,repeatIgnore:!0,code:function(){Visual.next(!1)}}),s.mappings.add("N",{annotation:"Previous found text",feature_group:9,repeatIgnore:!0,code:function(){Visual.next(!0)}}),s.mappings.add("E",{annotation:"Go one tab left",feature_group:3,repeatIgnore:!0,code:function(){RUNTIME("previousTab")}}),s.mappings.add("R",{annotation:"Go one tab right",feature_group:3,repeatIgnore:!0,code:function(){RUNTIME("nextTab")}}),s}(),Insert=function(){function e(){var e=getRealEdit();if(void 0!==e.setSelectionRange)try{e.setSelectionRange(e.value.length,e.value.length)}catch(t){if(!(t instanceof DOMException&&"InvalidStateError"===t.name))throw t}else if(isEditable(e)&&e.childNodes.length>0){var n=e.childNodes[e.childNodes.length-1];n.nodeType===Node.TEXT_NODE?document.getSelection().setPosition(n,n.data.length):document.getSelection().setPosition(n,0),Visual.showCursor(),Visual.hideCursor()}}function t(){var e=getRealEdit(),t="",o=!0;if(void 0!==e.selectionStart&&void 0!==e.value)t=e.value.substr(c,e.selectionStart-c);else{o=!1;var r=document.getSelection();t=r.focusNode.data.substr(c,r.focusOffset-c)}if(t.length<runtime.conf.startToShowEmoji||" "===t[0])l.remove();else{var i=s.filter(function(e){return e.indexOf(t)!==-1}).slice(0,5).map(function(e){var t=e.split("\t"),n=String.fromCodePoint.apply(null,t[0].split(","));return"<div><span>{0}</span>{1}</div>".format(n,t[1])}).join("");if(""===i)l.remove();else{setInnerHTML(l,i),document.body.append(l),l.style.display="",l.querySelector("#sk_emoji>div").classList.add("selected");var a;o?a=n(e):(Visual.showCursor(),a=Visual.getCursorPixelPos(),Visual.hideCursor());var d=a.top+a.height+4;window.innerHeight-d<l.offsetHeight&&(d=a.top-l.offsetHeight),l.style.position="fixed",l.style.top=d+"px",l.style.left=a.left+"px"}}}function n(e){var t=getComputedStyle(e),n=e.getBoundingClientRect(),o=document.createElement("div"),r=document.createElement("span");o.style.font=t.font,o.style.position="fixed",setInnerHTML(o,e.value),o.style.left=e.clientLeft+n.left+"px",o.style.top=e.clientTop+n.top+"px",o.style.color="red",o.style.overflow="scroll",o.style.visibility="hidden",o.style.whiteSpace="pre-wrap",o.style.padding=t.padding,o.style.width=t.width,o.style.height=t.height,r.innerText="I";var i=e.selectionStart;if(i===e.value.length)o.appendChild(r);else{var a=o.childNodes[0].splitText(i);o.insertBefore(r,a)}return document.body.appendChild(o),scrollIntoViewIfNeeded(r),n=r.getBoundingClientRect(),o.remove(),n}function o(e){var t=l.querySelector("#sk_emoji>div.selected"),n=Array.from(l.querySelectorAll("#sk_emoji>div")),o=(n.indexOf(t)+(e?-1:1))%n.length;t.classList.remove("selected"),n[o].classList.add("selected")}function r(e,t,n){var o=/\W/;for(n+=t;;){if(n<0){n=0;break}if(n>=e.length){n=e.length;break}if(o.test(e[n]))break;n+=t}return n}function i(e,t,n){var o=r(e,t,n),i=e;return o>n?i=e.substr(0,n)+e.substr(o+1):o<n&&(i=e.substr(0,o+1)+e.substr(n)),[i,o]}var a=new Mode("Insert");a.mappings=new Trie,a.map_node=a.mappings,a.mappings.add(KeyboardUtils.encodeKeystroke("<Ctrl-e>"),{annotation:"Move the cursor to the end of the line",feature_group:15,code:e}),a.mappings.add(KeyboardUtils.encodeKeystroke("<Ctrl-f>"),{annotation:"Move the cursor to the beginning of the line",feature_group:15,code:function(){var e=getRealEdit();if(void 0!==e.setSelectionRange)e.setSelectionRange(0,0);else{var t=document.getSelection();t.setPosition(t.focusNode,0),Visual.showCursor(),Visual.hideCursor()}}}),a.mappings.add(KeyboardUtils.encodeKeystroke("<Ctrl-u>"),{annotation:"Delete all entered characters before the cursor",feature_group:15,code:function(){var e=getRealEdit();if(void 0!==e.setSelectionRange)e.value=e.value.substr(e.selectionStart),e.setSelectionRange(0,0);else{var t=document.getSelection();t.focusNode.data=t.focusNode.data.substr(t.focusOffset)}}}),a.mappings.add(KeyboardUtils.encodeKeystroke("<Alt-b>"),{annotation:"Move the cursor Backward 1 word",feature_group:15,code:function(){var e=getRealEdit();if(void 0!==e.setSelectionRange){var t=r(e.value,-1,e.selectionStart);e.setSelectionRange(t,t)}else document.getSelection().modify("move","backward","word")}}),a.mappings.add(KeyboardUtils.encodeKeystroke("<Alt-f>"),{annotation:"Move the cursor Forward 1 word",feature_group:15,code:function(){var e=getRealEdit();if(void 0!==e.setSelectionRange){var t=r(e.value,1,e.selectionStart);e.setSelectionRange(t,t)}else document.getSelection().modify("move","forward","word")}}),a.mappings.add(KeyboardUtils.encodeKeystroke("<Alt-w>"),{annotation:"Delete a word backwards",feature_group:15,code:function(){var e=getRealEdit();if(void 0!==e.setSelectionRange){var t=i(e.value,-1,e.selectionStart);e.value=t[0],e.setSelectionRange(t[1],t[1])}else{var n=document.getSelection(),o=n.focusOffset;document.getSelection().modify("move","backward","word");var r=n.focusNode.data,a=n.focusOffset;n.focusNode.data=r.substr(0,a)+r.substr(o),n.setPosition(n.focusNode,a)}}}),a.mappings.add(KeyboardUtils.encodeKeystroke("<Alt-d>"),{annotation:"Delete a word forwards",feature_group:15,code:function(){var e=getRealEdit();if(void 0!==e.setSelectionRange){var t=i(e.value,1,e.selectionStart);e.value=t[0],e.setSelectionRange(t[1],t[1])}else{var n=document.getSelection(),o=n.focusOffset;document.getSelection().modify("move","forward","word");var r=n.focusNode.data,a=n.focusOffset;n.focusNode.data=r.substr(0,o)+r.substr(a),n.setPosition(n.focusNode,o)}}}),a.mappings.add(KeyboardUtils.encodeKeystroke("<Esc>"),{annotation:"Exit insert mode",feature_group:15,stopPropagation:function(e){return e.charCodeAt(0)<256},code:function(){getRealEdit().blur(),a.exit()}});var s,l=createElement('<div id="sk_emoji" style="display: block; opacity: 1;" />'),c=-1;a.mappings.add(":",{annotation:"Input emoji",feature_group:15,stopPropagation:function(){return!1},code:function(){var e=getRealEdit();c=void 0!==e.selectionStart?e.selectionStart:document.getSelection().focusOffset,fetch(chrome.extension.getURL("pages/emoji.tsv")).then(function(e){return Promise.all([e.text()])}).then(function(e){s=e[0].split("\n"),t()})}});var d=!1;a.addEventListener("keydown",function(e){if(!(e.key&&e.key.charCodeAt(0)>127)){var t=getRealEdit(e);if(l.offsetHeight>0){if(Mode.isSpecialKeyOf("<Esc>",e.sk_keyName))l.remove(),c=-1;else if(e.keyCode===KeyboardUtils.keyCodes.tab||e.keyCode===KeyboardUtils.keyCodes.upArrow||e.keyCode===KeyboardUtils.keyCodes.downArrow)o(e.shiftKey||e.keyCode===KeyboardUtils.keyCodes.upArrow),d=!0,e.sk_stopPropagation=!0;else if(e.keyCode===KeyboardUtils.keyCodes.enter){var n=l.querySelector("#sk_emoji>div.selected>span").innerHTML;if(void 0!==t.setSelectionRange){var r=t.value;t.value=r.substr(0,c-1)+n+r.substr(t.selectionStart),t.setSelectionRange(c,c)}else{var i=document.getSelection(),r=i.focusNode.data;i.focusNode.data=r.substr(0,c-1)+n+r.substr(i.focusOffset),i.setPosition(i.focusNode,c)}l.remove(),c=-1,e.sk_stopPropagation=!0}}else isEditable(t)?KeyboardUtils.keyCodes.enter===e.keyCode&&"input"===t.localName?setTimeout(function(){t.blur(),a.exit()},300):e.sk_keyName.length&&Mode.handleMapKey.call(a,e,function(e){var t=e.getPrefixWord();if(t){var n=getRealEdit(),o=n.value,r=n.selectionStart;if(void 0!==o&&void 0!==r)n.value=o.substr(0,n.selectionStart)+t+o.substr(n.selectionEnd),r+=t.length,n.setSelectionRange(r,r);else{n=document.getSelection();var i=n.getRangeAt(0),a=document.createTextNode(t);"Caret"===n.type?(o=n.focusNode.data,void 0===o?(i.insertNode(a),n.setPosition(a,a.length)):(r=n.focusOffset,n.focusNode.data=o.substr(0,r)+t+o.substr(r),n.setPosition(n.focusNode,r+t.length))):(i.deleteContents(),i.insertNode(a),n.setPosition(a,a.length))}}}):a.exit();e.sk_suppressed=!0}}),a.addEventListener("keyup",function(e){var n=getRealEdit(e);if(!d&&c!==-1){var o,r;if(void 0!==n.selectionStart&&void 0!==n.value)o=n.value,r=n.selectionStart;else{var i=document.getSelection();o=i.focusNode.data,r=i.focusOffset}r<c||":"!==o[c-1]?l.remove():t()}d=!1}),a.addEventListener("focus",function(e){var t=getRealEdit(e);isEditable(t)||a.exit()});var u,f=a.enter;return a.enter=function(t,n){t===document.body&&(runtime.conf.showModeStatus=!1);var o=f.call(a)===-1;u!==t&&(u=t,o=!0),o&&!n&&runtime.conf.cursorAtEndOfInput&&"SELECT"!==t.nodeName&&e()},a}(),Visual=function(){function e(e){if(window.navigator.userAgent.indexOf("Firefox")===-1||"p"!==e&&"s"!==e){var t=h[e];v.modify("move","backward",t),v.modify("extend","forward",t)}}function t(e,t){Hints.flashPressedLink(e),dispatchMouseEvent(e,["click"],t)}function n(e,t){g.hideCursor();var n=[v.anchorNode,v.anchorOffset];if(v.focusNode&&v.focusNode.textContent&&v.focusNode.textContent.length&&v.focusNode.textContent[v.focusOffset]===t&&1===e&&v.setPosition(v.focusNode,v.focusOffset+1),p(t,!0,e===-1))if(1===b)v.setPosition(v.focusNode,v.focusOffset-1);else{var o=[v.focusNode,v.focusOffset-1];v.collapseToStart(),v.setPosition(n[0],n[1]),v.extend(o[0],o[1])}else v.setPosition(n[0],n[1]);g.showCursor()}function o(e){for(var t=null,n=getTextNodes(document.body,/./,0);n.nextNode();){var o=n.currentNode.parentNode.getBoundingClientRect();if(o.top>window.innerHeight*e){t=n.currentNode;break}}return t}function r(e,t){var n=e,o=/\W/;t<0?t=0:t>=e.length&&(t=e.length-1);var r=!0;if(o.test(e[t])){var i=0;for(r=!1;!r&&(t>i||t+i<e.length);)i++,r=t-i>=0&&!o.test(e[t-i])||t+i<e.length&&!o.test(e[t+i]);t=t-i>=0&&!o.test(e[t-i])?t-i:t+i}if(r){for(var a=t,s=t;a>=0&&!o.test(e[a]);)a--;for(;s<e.length&&!o.test(e[s]);)s++;n=e.substr(a+1,s-a-1)}return n}function i(){return N.setStart(arguments[0],arguments[1]),arguments.length>3?N.setEnd(arguments[2],arguments[3]):N.setEnd(arguments[0],arguments[1]),N.getBoundingClientRect()}function a(e){g.hideCursor(),v.anchorNode&&2===b?v.extend(e[0],e[1]):v.setPosition(e[0],e[1]),g.showCursor()}function s(){var e=g.map_node.meta.annotation.split(" "),t=2===b?"extend":"move";g.hideCursor();var n=[v.focusNode,v.focusOffset];v.modify(t,e[0],e[1]),n[0]===v.focusNode&&n[1]===v.focusOffset&&v.modify(t,e[0],"word"),g.showCursor()}function l(e,t,n,o){var r=i(e,t,n,o);if(r.width>0&&r.height>0){var a=E.cloneNode(!1);a.style.position="absolute",a.style.zIndex=2147483298,a.style.left=document.scrollingElement.scrollLeft+r.left+"px",a.style.top=document.scrollingElement.scrollTop+r.top+"px",a.style.width=r.width+"px",a.style.height=r.height+"px",T.appendChild(a),document.body.contains(T)||document.body.appendChild(T),w.push([e,t,a])}}function c(e){if(getTextNodes(document.body,e).forEach(function(t){for(var n;null!==(n=e.exec(t.data));){var o=n[0];if(!o.length)break;var r=e.lastIndex-o.length;l(t,r,t,r+o.length)}}),0===w.length)for(v.setPosition(null,0);p(e.source,e.flags.indexOf("i")===-1,!1);)v.anchorNode!==v.focusNode&&l(v.anchorNode,v.anchorOffset,v.focusNode,v.focusOffset);if(w.length){y=0;for(var t=0;t<w.length;t++){var n=w[t][2].getBoundingClientRect();if(n.top>0){y=t;break}}Front.showStatus(2,y+1+" / "+w.length)}}function d(){Front.hideBubble()}function u(){g.mappings.add("y",m[b]),g.statusLine=g.name+" - "+k[b],Mode.showStatus()}function f(){b=(b+1)%3,u()}function p(e,t,n){for(var o=!1,r=null;window.find(e,t,n);){if(v.anchorNode.splitText){o=!0;break}if(null===r)r=v.anchorNode;else if(r===v.anchorNode)break}return o}var g=new Mode("Visual");g.addEventListener("keydown",function(e){if(S){var t=!1;e.sk_stopPropagation=!0,e.sk_suppressed=!0,KeyboardUtils.isWordChar(e)?(n(S,e.sk_keyName),x=[S,e.sk_keyName],t=!0):Mode.isSpecialKeyOf("<Esc>",e.sk_keyName)&&(t=!0),t&&(g.statusLine=g.name+" - "+k[b],Mode.showStatus(),S=0)}else e.sk_keyName.length&&(Mode.handleMapKey.call(g,e),e.sk_stopPropagation?e.sk_suppressed=!0:Mode.isSpecialKeyOf("<Esc>",e.sk_keyName)&&(b>1?(g.hideCursor(),v.collapse(v.anchorNode,v.anchorOffset),g.showCursor()):(g.visualClear(),g.exit()),b--,u(),e.sk_stopPropagation=!0,e.sk_suppressed=!0))}),g.addEventListener("click",function(e){switch(v.type){case"None":g.hideCursor(),b=0;break;case"Caret":b&&(g.hideCursor(),0===b&&(b=1),g.showCursor());break;case"Range":b&&(g.hideCursor(),b=2,g.showCursor())}u()}),g.mappings=new Trie,g.map_node=g.mappings,g.repeats="",g.mappings.add("l",{annotation:"forward character",feature_group:9,code:s}),g.mappings.add("h",{annotation:"backward character",feature_group:9,code:s}),g.mappings.add("j",{annotation:"forward line",feature_group:9,code:s}),g.mappings.add("k",{annotation:"backward line",feature_group:9,code:s}),g.mappings.add("w",{annotation:"forward word",feature_group:9,code:s}),g.mappings.add("e",{annotation:"forward word",feature_group:9,code:s}),g.mappings.add("b",{annotation:"backward word",feature_group:9,code:s}),g.mappings.add(")",{annotation:"forward sentence",feature_group:9,code:s}),g.mappings.add("(",{annotation:"backward sentence",feature_group:9,code:s}),g.mappings.add("}",{annotation:"forward paragraphboundary",feature_group:9,code:s}),g.mappings.add("{",{annotation:"backward paragraphboundary",feature_group:9,code:s}),g.mappings.add("0",{annotation:"backward lineboundary",feature_group:9,code:s}),g.mappings.add("$",{annotation:"forward lineboundary",feature_group:9,code:s}),g.mappings.add("G",{annotation:"forward documentboundary",feature_group:9,code:function(){document.scrollingElement.scrollTop=document.scrollingElement.scrollHeight,window.navigator.userAgent.indexOf("Firefox")===-1?s():(g.hideCursor(),v.setPosition(document.body.lastChild,0),g.showCursor()),w.length&&(y=w.length-1,Front.showStatus(2,y+1+" / "+w.length))}}),g.mappings.add("gg",{annotation:"backward documentboundary",feature_group:9,code:function(){document.scrollingElement.scrollTop=0,y=0,w.length&&Front.showStatus(2,y+1+" / "+w.length),window.navigator.userAgent.indexOf("Firefox")===-1?s():(g.hideCursor(),v.setPosition(document.body.firstChild,0),g.showCursor())}}),g.mappings.add("o",{annotation:"Go to Other end of highlighted text",feature_group:9,code:function(){g.hideCursor();var e=[v.anchorNode,v.anchorOffset];v.collapse(v.focusNode,v.focusOffset),v.extend(e[0],e[1]),g.showCursor()}});var h={w:"word",l:"lineboundary",s:"sentence",p:"paragraphboundary"},m=[{},{annotation:"Yank a word(w) or line(l) or sentence(s) or paragraph(p)",feature_group:9,code:function(t){var n=[v.focusNode,v.focusOffset];g.hideCursor(),e(t),Clipboard.write(v.toString()),v.collapseToStart(),v.setPosition(n[0],n[1]),g.showCursor()}},{annotation:"Copy selected text",feature_group:9,code:function(){var e=[v.focusNode,v.focusOffset];Clipboard.write(v.toString()),"Caret"===runtime.conf.modeAfterYank?(v.setPosition(e[0],e[1]),g.showCursor(),b=1,u()):"Normal"===runtime.conf.modeAfterYank&&(b=2,g.toggle())}}];g.mappings.add("*",{annotation:"Search word under the cursor",feature_group:9,code:function(){g.star()}}),g.mappings.add(KeyboardUtils.encodeKeystroke("<Enter>"),{annotation:"Click on node under cursor.",feature_group:9,code:function(){t(v.focusNode.parentNode,!1)}}),g.mappings.add(KeyboardUtils.encodeKeystroke("<Shift-Enter>"),{annotation:"Click on node under cursor.",feature_group:9,code:function(){t(v.focusNode.parentNode,!0)}}),g.mappings.add("zz",{annotation:"make cursor at center of window.",feature_group:9,code:function(){var e=C.getBoundingClientRect().top-window.innerHeight/2;g.hideCursor(),document.scrollingElement.scrollTop+=e,g.showCursor()}}),g.mappings.add("f",{annotation:"Forward to next char.",feature_group:9,code:function(){g.statusLine=g.name+" - "+k[b]+" - forward",Mode.showStatus(),S=1}}),g.mappings.add("F",{annotation:"Backward to next char.",feature_group:9,code:function(){g.statusLine=g.name+" - "+k[b]+" - backward",Mode.showStatus(),S=-1}}),g.mappings.add(";",{annotation:"Repeat latest f, F",feature_group:9,code:function(){x&&n(x[0],x[1])}}),g.mappings.add(",",{annotation:"Repeat latest f, F in opposite direction",feature_group:9,code:function(){x&&n(-x[0],x[1])}}),g.mappings.add("p",{annotation:"Expand selection to parent element",feature_group:9,code:function(){for(var e=v.focusNode;e!==document.body;){e=e.parentElement;var t=getTextNodes(e,/./),n=t[t.length-1],o=v.getRangeAt(0);if(o.comparePoint(t[0],0)===-1||1===o.comparePoint(n,n.length)){g.hideCursor(),b=2,u(),v.setBaseAndExtent(t[0],0,n,n.length),g.showCursor();break}}}}),g.mappings.add("q",{annotation:"Translate word under cursor",feature_group:9,code:function(){var e=Visual.getWordUnderCursor();readText(e),Front.performInlineQuery(e,function(e){var t=C.getBoundingClientRect();Front.showBubble({left:t.left,top:t.top,height:t.height,width:t.width},e,!0)})}}),g.mappings.add("V",{annotation:"Select a word(w) or line(l) or sentence(s) or paragraph(p)",feature_group:9,code:function(t){g.hideCursor(),b=2,u(),e(t),g.showCursor()}});var y,v=document.getSelection(),w=[],b=0,k=["","Caret","Range"],E=document.createElement("surfingkeys_mark"),C=document.createElement("div");C.className="surfingkeys_cursor",C.style.zIndex=2147483298;var S=0,x=null;g.hideCursor=function(){document.body.contains(C)&&(C.remove(),document.dispatchEvent(new CustomEvent("surfingkeys:cursorHidden")))};var N=document.createRange();g.showCursor=function(){if(v.focusNode&&(v.focusNode.offsetHeight>0||v.focusNode.parentNode.offsetHeight>0)){scrollIntoViewIfNeeded(v.focusNode.parentElement,!0);var e=i(v.focusNode,v.focusOffset);C.style.position="fixed",C.style.left=e.left+"px",e.left<0||e.left>=window.innerWidth?(document.scrollingElement.scrollLeft+=e.left-window.innerWidth/2,C.style.left=window.innerWidth/2+"px"):C.style.left=e.left+"px",e.top<0||e.top>=window.innerHeight?(document.scrollingElement.scrollTop+=e.top-window.innerHeight/2,C.style.top=window.innerHeight/2+"px"):C.style.top=e.top+"px",C.style.height=e.height+"px",C.style.width=e.width+"px",document.body.appendChild(C)}},g.getCursorPixelPos=function(){return C.getBoundingClientRect()};var T=document.createElement("div");g.visualClear=function(){g.hideCursor(),w=[],M.forEach(function(e){e.onscroll=null}),M=[],setInnerHTML(T,""),T.remove(),Front.showStatus(2,"")},g.onEnter=function(){document.addEventListener("surfingkeys:cursorHidden",d),f()};var _=null;g.onExit=function(){document.removeEventListener("surfingkeys:cursorHidden",d),_=[v.anchorNode,v.anchorOffset]},g.restore=function(){_&&(v.setPosition(_[0],_[1]),g.showCursor(),g.enter())},g.toggle=function(e){switch(b){case 1:v.extend(v.anchorNode,v.anchorOffset),f();break;case 2:g.hideCursor(),v.collapse(v.focusNode,v.focusOffset),g.exit(),f();break;default:if("ym"===e){var t=[];Hints.create(runtime.conf.textAnchorPat,function(e){t.push(e[2].trim()),Clipboard.write(t.join("\n"))},{multipleHits:!0})}else Hints.create(runtime.conf.textAnchorPat,function(t){if("y"===e)Clipboard.write(0===t[1]?t[0].data.trim():t[2].trim());else if("q"===e){var n=t[2].trim().replace(/[^A-z].*$/,""),o=getTextNodePos(t[0],t[1],t[2].length);Front.performInlineQuery(n,function(e){Front.showBubble({top:o.top,left:o.left,height:o.height,width:o.width},e,!1)})}else setTimeout(function(){v.setPosition(t[0],t[1]),g.enter(),"z"===e&&(v.extend(t[0],t[1]+t[2].length),f()),g.showCursor()},0)})}},g.star=function(){if(v.focusNode&&v.focusNode.nodeValue){var e=g.getWordUnderCursor();if(e.length&&"."!==e){g.hideCursor();var t=[v.focusNode,v.focusOffset];runtime.updateHistory("find",e),g.visualClear(),c(new RegExp(e,"g"+(runtime.getCaseSensitive(e)?"":"i"))),v.setPosition(t[0],t[1]),g.showCursor()}}},g.getWordUnderCursor=function(){var e=v.toString();if(0===e.length&&v.focusNode){var t=v.focusNode;e=r(t.textContent,v.focusOffset)}return e},g.next=function(e){w.length?(0===b&&g.enter(),y=(e?w.length+y-1:y+1)%w.length,a(w[y]),Front.showStatus(2,y+1+" / "+w.length)):runtime.conf.lastQuery&&(c(new RegExp(runtime.conf.lastQuery,"g"+(runtime.getCaseSensitive(runtime.conf.lastQuery)?"":"i"))),g.visualEnter(runtime.conf.lastQuery))},g.feedkeys=function(e){setTimeout(function(){for(var t=new Event("keydown"),n=0;n<e.length;n++)t.sk_keyName=e[n],Mode.handleMapKey.call(g,t)},1)},g.visualUpdateForContentWindow=function(e){g.visualClear(),v.setPosition(o(0),0);var t=document.scrollingElement.scrollTop,n=[v.anchorNode,v.anchorOffset],r=runtime.getCaseSensitive(e);if(p(e,r,!1)?v.setPosition(n[0],n[1]):v.setPosition(document.body.firstChild,0),p(e,r,!1)){for(document.scrollingElement.scrollTop!==t&&(t=document.scrollingElement.scrollTop,n=[v.anchorNode,v.anchorOffset]),l(v.anchorNode,v.anchorOffset,v.focusNode,v.focusOffset);document.scrollingElement.scrollTop===t&&p(e,r,!1);)l(v.anchorNode,v.anchorOffset,v.focusNode,v.focusOffset);document.scrollingElement.scrollTop=t,v.setPosition(n[0],n[1])}},g.visualUpdate=function(e){e.length&&"."!==e&&(g.visualClear(),c(new RegExp(e,"g"+(runtime.getCaseSensitive(e)?"":"i"))))};var M=[];g.visualEnter=function(e){0!==e.length&&"."!==e&&(g.visualClear(),c(new RegExp(e,"g"+(runtime.getCaseSensitive(e)?"":"i"))),w.length?(g.enter(),a(w[y])):Front.showStatus(2,"Pattern not found: {0}".format(e),1e3),Normal.getScrollableElements().forEach(function(e){e!==document.scrollingElement&&(e.onscroll=function(){w.forEach(function(e){var t=i(e[0],e[1]);e[2].style.left=document.scrollingElement.scrollLeft+t.left+"px",e[2].style.top=document.scrollingElement.scrollTop+t.top+"px"})},M.push(e))}))},g.findSentenceOf=function(t){var n=new RegExp("\\b"+t+"\\b"),o=getVisibleElements(function(e,t){n.test(e.innerText)&&t.push(e)});o=filterAncestors(o);var r="";return actionWithSelectionPreserved(function(n){n.setPosition(o[0],0),window.find(t,!1,!1,!0,!0)&&(e("s"),r=n.toString())}),r};var I={};return g.style=function(e,t){I[e]=t,C.setAttribute("style",I.cursor||""),E.setAttribute("style",I.marks||"")},g}(),Hints=function(){function e(e){return e===e.toUpperCase()&&e!==e.toLowerCase()}function t(e){var t=0;do{var n=parseInt(getComputedStyle(e).getPropertyValue("z-index"));t+=isNaN(n)||n<0?0:n,e=e.parentNode}while(e&&e!==document.body&&e!==document&&e.nodeType!==e.DOCUMENT_FRAGMENT_NODE);return t}function n(){var e=r();if(1===e.length){Normal.appendKeysForRepeat("Hints",m);var t=e[0].link;C(t),w.multipleHits?(m="",r()):i()}else 0===e.length&&i()}function o(){var e=b.querySelectorAll("#sk_hints>div");e=Array.from(e),y.length>0&&(e=e.filter(function(e){e.label="",setInnerHTML(e,"");var t=e.link,n=t.innerText;return void 0===n&&(n=t[0]?t[0].textContent:""),n.indexOf(y)!==-1}));var t=h.genLabels(e.length);e.forEach(function(e,n){e.label=t[n],setInnerHTML(e,t[n])})}function r(){var e=[],t=b.querySelectorAll("#sk_hints>div:not(:empty)");return t.forEach(function(t){var n=t.label;0===m.length?(t.style.opacity=1,setInnerHTML(t,n),e.push(t)):0===n.indexOf(m)?(t.style.opacity=1,setInnerHTML(t,'<span style="opacity: 0.0; display: none;">'+m+"</span>"+n.substr(m.length)),e.push(t)):t.style.opacity=0}),e}function i(){w={active:!0,tabbed:!1,mouseEvents:["mouseover","mousedown","mouseup","click"],multipleHits:!1},setInnerHTML(b,""),b.remove(),m="",y="",k=!1,h.exit()}function a(){var e=b.querySelectorAll("#sk_hints>div");e[0].style.zIndex==e[0].zIndex?e.forEach(function(t,n){var o=parseInt(t.style.zIndex);t.style.zIndex=e.length-n+2147483e3-o}):e.forEach(function(e,t){e.style.zIndex=e.zIndex})}function s(e){setInnerHTML(b,""),b.remove(),m=""}function l(e){var t=(new Date).getTime(),n=g(S,E);n>1&&(h.statusLine+=" - "+((new Date).getTime()-t)+"ms / "+n,Mode.showStatus())}function c(e){setInnerHTML(b,""),b.setAttribute("mode",e),b.style.display=""}function d(e){c("click");var n=h.genLabels(e.length),o=h.coordinate(),r=createElement("<style>#sk_hints>div.myHint{"+N+"}</style>");b.prepend(r);var i=e.map(function(e,r){var i,a=e.getClientRects()[0],s=t(e),l=Math.min(a.width,window.innerWidth);i="right"===runtime.conf.hintAlign?window.pageXOffset+a.left-o.left+l:"left"===runtime.conf.hintAlign?window.pageXOffset+a.left-o.left:window.pageXOffset+a.left-o.left+l/2,i<window.pageXOffset?i=window.pageXOffset:i+32>window.pageXOffset+window.innerWidth&&(i=window.pageXOffset+window.innerWidth-32);var c=createElement('<div class="myHint">'+n[r]+"</div>");return e.dataset.hint_scrollable&&c.classList.add("hint-scrollable"),c.style.top=Math.max(a.top+window.pageYOffset-o.top,0)+"px",c.style.left=i+"px",c.style.zIndex=s+9999,c.zIndex=c.style.zIndex,c.label=n[r],c.link=e,c});i.forEach(function(e){b.appendChild(e)});for(var a=b.querySelectorAll("#sk_hints>div"),s=a[0].getBoundingClientRect(),l=1;l<a.length;l++){var d=a[l],u=d.getBoundingClientRect();u.top===s.top&&Math.abs(u.left-s.left)<s.width&&(d.style.top=d.offsetTop+d.offsetHeight+"px"),s=d.getBoundingClientRect()}document.documentElement.prepend(b)}function u(e,t){t=Object.assign({active:!0,tabbed:!1,mouseEvents:["mouseover","mousedown","mouseup","click"],multipleHits:!1,filterInvisible:!0},t||{});for(var n in t)w[n]=t[n];return h.statusLine=t&&t.statusLine||"Hints to click",t.filterInvisible&&(e=filterInvisibleElements(e)),e.length>0&&d(e),e.length}function f(e,t){h.statusLine="Hints to click",t=Object.assign({active:!0,tabbed:!1,mouseEvents:["mouseover","mousedown","mouseup","click"],multipleHits:!1},t||{});for(var n in t)w[n]=t[n];var o;return w.tabbed?(o=Array.from(getElements("a[href]:not([href^=javascript])")),o=filterInvisibleElements(o)):""===e?(o=getVisibleElements(function(e,t){isElementClickable(e)&&t.push(e)}),o=filterOverlapElements(o)):Array.isArray(e)?o=filterInvisibleElements(e):(o=Array.from(document.documentElement.querySelectorAll(e)),o=filterInvisibleElements(o),o=filterOverlapElements(o)),o.length>0&&d(o),o.length}function p(e,n){for(var o in n)w[o]=n[o];h.statusLine=n&&n.statusLine||"Hints to select text";var r=getVisibleElements(function(e,t){for(var n=e.childNodes,o=0,r=n.length;o<r;o++)if(n[o].nodeType==Node.TEXT_NODE&&n[o].data.length>0){t.push(e);break}});r=r.flatMap(function(e){for(var t=e.childNodes,n=[],o=0,r=t.length;o<r;o++)t[o].nodeType==Node.TEXT_NODE&&t[o].data.trim().length>1&&n.push(t[o]);return n});var i;if(e.flags.indexOf("g")===-1)i=r.map(function(e){return[e,0,""]});else{i=[];for(var a=0,s=r.length;a<s;a++)for(var l,d=r[a];null!=(l=e.exec(d.data));)i.push([d,l.index,l[0]])}if(r=i.map(function(e){var n=getTextNodePos(e[0],e[1]),o=[0,0,window.innerHeight,window.innerWidth];if(runtime.conf.caretViewport&&4===runtime.conf.caretViewport.length&&(o=runtime.conf.caretViewport),0===e[0].data.trim().length||n.top<o[0]||n.left<o[1]||n.top>o[2]||n.left>o[3])return null;var r=t(e[0].parentNode),i=createElement("<div/>");return 0===e[1]&&(i.className="begin"),i.style.position="fixed",i.style.top=n.top+"px",i.style.left=n.left+"px",i.style.zIndex=r+9999,i.zIndex=i.style.zIndex,i.link=e,i}).filter(function(e){return null!==e}),document.getSelection().anchorNode&&document.getSelection().collapseToStart(),r.length>0){c("text");var u=h.genLabels(r.length);r.forEach(function(e,t){e.label=u[t],setInnerHTML(e,u[t]),b.append(e)});var f=createElement("<style>#sk_hints[mode='text']>div{"+x+"}</style>");b.prepend(f),document.documentElement.prepend(b)}return r.length}function g(e,t){return"RegExp"===e.constructor.name?p(e,t):Array.isArray(e)?u(e,t):f(e,t)}var h=new Mode("Hints");h.addEventListener("keydown",function(t){var r=b.querySelectorAll("#sk_hints>div");t.sk_stopPropagation=!0;var s=document.querySelector("#sk_hints[mode=input]>div.activeInput");if(null!==s){var l=s.link;return void(Mode.isSpecialKeyOf("<Esc>",t.sk_keyName)?(l.blur(),i()):t.keyCode===KeyboardUtils.keyCodes.tab?(s.classList.remove("activeInput"),E.activeInput=(E.activeInput+(t.shiftKey?-1:1))%r.length,s=r[E.activeInput],s.classList.add("activeInput"),l=s.link,l.focus()):t.keyCode!==KeyboardUtils.keyCodes.shiftKey&&(t.sk_stopPropagation=!1,i(),Insert.enter(l)))}if(Mode.isSpecialKeyOf("<Esc>",t.sk_keyName))i();else if(t.keyCode===KeyboardUtils.keyCodes.space)b.style.display="none";else if(t.keyCode===KeyboardUtils.keyCodes.shiftKey)a();else if(r.length>0)if(t.keyCode===KeyboardUtils.keyCodes.backspace)m.length>0?(m=m.substr(0,m.length-1),n()):y.length>0&&(y=y.substr(0,y.length-1),o());else{var c=t.sk_keyName;e(c)&&(k=!0),""!==c&&(h.numericHints?(c>="0"&&c<="9"?m+=c:(y+=c,o()),n()):h.characters.toLowerCase().indexOf(c.toLowerCase())!==-1?(m+=c.toUpperCase(),n()):h.scrollKeys.indexOf(c)===-1?i():t.sk_stopPropagation=!1)}}),h.addEventListener("keyup",function(e){e.keyCode===KeyboardUtils.keyCodes.space&&(b.style.display="")});var m="",y="",v=null,w={mouseEvents:["mouseover","mousedown","mouseup","click"]},b=createElement('<div id="sk_hints" style="display: block; opacity: 1;"/>'),k=!1;h.characters="asdfgqwertzxcvb",h.scrollKeys="0jkhlG$";var E={},C=h.dispatchMouseClick,S="";h.onEnter=function(){document.addEventListener("surfingkeys:scrollStarted",s),document.addEventListener("surfingkeys:scrollDone",l)},
h.onExit=function(){document.removeEventListener("surfingkeys:scrollStarted",s),document.removeEventListener("surfingkeys:scrollDone",l)},h.genLabels=function(e){if(e<=h.characters.length)return h.characters.slice(0,e).toUpperCase().split("");for(var t=[],n=function(e,n){for(var o=0,r="";o<n;o++)r+=h.characters.charAt(e%h.characters.length).toUpperCase(),e=~~(e/h.characters.length);t.push(r.split("").reverse().join(""))},o=Math.ceil(Math.log(e)/Math.log(h.characters.length)),r=Math.pow(h.characters.length,o)-e,i=~~(r/(h.characters.length-1)),a=0;a<i;a++)n(a,o-1);for(var s=i;s<e;s++)n(s+r,o);return t},h.coordinate=function(){var e=createElement('<div style="top: 0; left: 0;">A</div>');b.prepend(e),document.documentElement.prepend(b);var t=e.getBoundingClientRect();return setInnerHTML(b,""),{top:t.top+window.pageYOffset-document.documentElement.clientTop,left:t.left+window.pageXOffset-document.documentElement.clientLeft}},h.createInputLayer=function(){var e="input",n=getVisibleElements(function(t,n){!t.matches(e)||t.disabled||t.readOnly||"text"!==t.type&&"password"!==t.type||n.push(t)});if(0===n.length&&null!==document.querySelector(e)&&(document.querySelector(e).scrollIntoView(),n=getVisibleElements(function(t,n){!t.matches(e)||t.disabled||t.readOnly||n.push(t)})),n.length>1){h.enter(),c("input"),n.forEach(function(e,n){var o=e.getBoundingClientRect(),r=t(e),i=createElement("<div/>");i.style.position="fixed",i.style.top=o.top+"px",i.style.left=o.left+"px",i.style.width=o.width+"px",i.style.height=o.height+"px",i.style.zIndex=r+9999,i.link=e,i.innerText=" ",b.append(i)}),document.documentElement.prepend(b),E.activeInput=0;var o=document.querySelector("#sk_hints[mode=input]>div");o.classList.add("activeInput"),Normal.passFocus(!0),o.link.focus()}else 1===n.length&&(Normal.passFocus(!0),n[0].focus(),Insert.enter(n[0]))},h.getSelector=function(){return S},h.create=function(e,t,o){h.numericHints&&(h.characters="1234567890"),S=e,C=t,E=o||{};var r=(new Date).getTime(),i=g(e,o);i>1?(h.statusLine+=" - "+((new Date).getTime()-r)+"ms / "+i,h.enter()):n()},h.flashPressedLink=function(e){var t=e.getBoundingClientRect(),n=createElement('<div style="position: fixed; box-shadow: 0px 0px 4px 2px #63b2ff; background: transparent; z-index: 2140000000"/>');n.style.left=t.left+"px",n.style.top=t.top+"px",n.style.width=t.width+"px",n.style.height=t.height+"px",document.body.appendChild(n),setTimeout(function(){n.remove()},300)},h.dispatchMouseClick=function(e,t){if(h.flashPressedLink(e),isEditable(e))h.exit(),Normal.passFocus(!0),e.focus(),Insert.enter(e);else{w.multipleHits||h.exit();var n=w.tabbed,o=w.active;w.multipleHits&&e.href&&(n=!0,o=!1),k&&window.navigator.userAgent.indexOf("Firefox")!==-1&&(n=!0,o=!0),n?RUNTIME("openLink",{tab:{tabbed:n,active:o},url:e.href}):(h.mouseoutLastElement(),dispatchMouseEvent(e,w.mouseEvents,k),v=e)}},h.mouseoutLastElement=function(){v&&(dispatchMouseEvent(v,["mouseout"],!1),v=null)};var x="",N="";return h.style=function(e,t){"text"===t?x=e:N=e},h.feedkeys=function(e){setTimeout(function(){m=e.toUpperCase(),n()},1)},h}(),Clipboard=function(e){function t(e){actionWithSelectionPreserved(function(t){document.documentElement.appendChild(o),e(t),o.remove()})}var n={},o=document.createElement("textarea");return o.contentEditable=!0,o.enableAutoFocus=!0,o.id="sk_clipboard",n.read=function(e){t(function(){o.value="",setInnerHTML(o,""),o.focus(),document.execCommand("Paste")});var n=o.value;""===n&&(n=o.innerHTML.replace(/<br>/gi,"\n")),e({data:n})},n.write=function(e){t(function(){o.value=e,o.select(),document.execCommand("copy"),o.value=""}),Front.showBanner("Copied: "+e)},n}();