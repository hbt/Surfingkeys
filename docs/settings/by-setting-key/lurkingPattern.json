{
  "short": "Regex pattern to enable lurking mode on matching sites",
  "unique_id": "setting_lurkingPattern",
  "category": "extension-control",
  "description": "A regular expression pattern used to automatically enable 'lurking mode' on websites matching the pattern. When a page's URL matches this regex, Surfingkeys enters lurking mode where keyboard commands are disabled but can be temporarily re-enabled with a specific keystroke. This provides a soft disable for sites where you want Surfingkeys available but not actively interfering with the page's native keyboard shortcuts.",
  "tags": [
    "regex",
    "site-control",
    "lurking-mode",
    "url-matching",
    "extension-state",
    "soft-disable"
  ],
  "valueType": "regex-string",
  "valueDescription": "A JavaScript regular expression pattern as a string. The pattern is tested against the full URL (href) of the current page. If undefined or empty string, no URL-based lurking mode is applied.",
  "values": [
    {
      "value": "undefined",
      "description": "Default value; no URL pattern-based lurking mode is applied",
      "source": "src/content_scripts/common/runtime.js:48 - Initial declaration in runtime.conf"
    },
    {
      "value": "\"example\\\\.com\"",
      "description": "Enable lurking mode on example.com and all subdomains",
      "source": "User configuration"
    },
    {
      "value": "\".*\\\\.github\\\\.com/.*\"",
      "description": "Enable lurking mode on all GitHub URLs and subdomains",
      "source": "User configuration"
    },
    {
      "value": "\"https?://.*\\\\.wikipedia\\\\.org/.*\"",
      "description": "Enable lurking mode on Wikipedia (both http and https)",
      "source": "User configuration"
    },
    {
      "value": "\"^https://mail\\\\.google\\\\.com/.*\"",
      "description": "Enable lurking mode only on Gmail HTTPS URLs",
      "source": "User configuration"
    }
  ],
  "usageContext": {
    "files": [
      "src/content_scripts/common/runtime.js",
      "src/content_scripts/content.js",
      "src/background/start.js"
    ],
    "operations": [
      {
        "type": "declaration",
        "file": "src/content_scripts/common/runtime.js",
        "line": 48,
        "function": "runtime",
        "context": "Initialized as undefined in runtime.conf object"
      },
      {
        "type": "read",
        "file": "src/content_scripts/content.js",
        "line": 69,
        "function": "applyRuntimeConf",
        "context": "Read from runtime.conf and passed to background getState to determine if current site should enter lurking mode"
      },
      {
        "type": "test",
        "file": "src/background/start.js",
        "line": 832,
        "function": "_getState",
        "context": "Checked to see if lurkingPattern is defined before testing"
      },
      {
        "type": "test",
        "file": "src/background/start.js",
        "line": 833,
        "function": "_getState",
        "context": "Converted from object with source and flags to new RegExp instance"
      },
      {
        "type": "test",
        "file": "src/background/start.js",
        "line": 834,
        "function": "_getState",
        "context": "lurkingPattern.test(url.href) returns true when URL matches pattern, setting extension to 'lurking' state"
      }
    ]
  },
  "relatedSettings": [
    "settings.blocklistPattern",
    "settings.blocklist",
    "settings.disabledOnActiveElementPattern"
  ],
  "relatedCommands": [
    "toggleLurk - toggles lurking mode for current site"
  ],
  "usageNotes": [
    "The regex pattern is tested against the full page URL including protocol and query parameters",
    "If set to undefined or empty string, the setting is effectively ignored",
    "Changes take effect when navigating to a new site or reloading the page",
    "Lurking mode disables keyboard commands but allows re-activation with specific keystroke",
    "sites.blocklist (toggled via Alt-s) is for temporary manual disabling",
    "blocklistPattern is for permanent automatic disabling (fully disabled state)",
    "lurkingPattern is for automatic soft disable (lurking state, re-activable)",
    "Malformed regex patterns will not throw errors but will not match any URLs",
    "Lurking mode puts extension into 'lurk' state instead of fully 'disabled' state"
  ],
  "stateTransitions": {
    "description": "Extension state evaluation order in _getState()",
    "order": [
      "1. Check blocklist['.*'] - if present, return 'disabled'",
      "2. Check blocklist[url.origin] - if present, return 'disabled'",
      "3. Test blocklistPattern against url.href - if matches, return 'disabled'",
      "4. Test lurkingPattern against url.href - if matches, return 'lurking'",
      "5. Default to 'enabled' state"
    ]
  },
  "implementation": {
    "flowDiagram": "content.js (readValue) → passes to background via RUNTIME('getState') → start.js _getState() (tests URL) → returns disabled/lurking/enabled state → content.js (adjusts Surfingkeys state)"
  },
  "examples": [
    {
      "title": "Lurk on single domain",
      "code": "settings.lurkingPattern = 'example\\\\.com'"
    },
    {
      "title": "Lurk on multiple domains",
      "code": "settings.lurkingPattern = '(example|test|staging)\\\\.com'"
    },
    {
      "title": "Lurk on specific path",
      "code": "settings.lurkingPattern = 'github\\\\.com/.*search.*'"
    },
    {
      "title": "Lurk on mail services but keep full disable for sensitive areas",
      "code": "settings.blocklistPattern = 'mail\\\\.google\\\\.com/settings'; settings.lurkingPattern = 'mail\\\\.google\\\\.com'"
    }
  ],
  "notes": "This is a configuration setting that determines URL-based extension state (lurking vs enabled) at page load/navigation. It is evaluated in the background service worker and communicated to content scripts. Unlike settings.blocklist (which stores individual disabled sites), lurkingPattern applies a pattern-based rule for convenience on broader site categories. Lurking mode differs from fully disabled in that users can re-activate commands with a keystroke, making it suitable for sites where keyboard shortcuts are important but potentially interfering with native site functionality."
}
